<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>AgriTrio Mobile</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root {
    --primary-color: #2563eb;
    --secondary-color: #1d4ed8;
    --bg-color: #f1f5f9;
    --text-color: #1e293b;
    --card-bg: #fff;
  }
  [data-theme="dark"] {
    --bg-color: #1e293b;
    --text-color: #f1f5f9;
    --card-bg: #334155;
  }
  body { font-family: 'Inter', sans-serif; margin: 0; background: var(--bg-color); color: var(--text-color); transition: all 0.3s; }
  header { background: linear-gradient(90deg,var(--primary-color),var(--secondary-color)); color: white; padding: 15px 20px; font-size: 1.4em; text-align: center; }
  .container { display: flex; flex-direction: column; transition: all 0.3s; }
  nav { display: flex; overflow-x: auto; background: var(--card-bg); padding: 5px; }
  nav button { flex: 1; margin: 5px; padding: 10px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; transition: 0.2s; }
  nav button.active { background: var(--primary-color); color: white; }
  nav button:hover { background: var(--secondary-color); color: white; }
  main { flex: 1; padding: 15px; }
  .card { background: var(--card-bg); border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); padding: 15px; margin-bottom: 15px; transition: all 0.3s; }
  .card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
  .btn { padding: 8px 12px; border-radius: 6px; border: none; cursor: pointer; margin: 5px 0; transition: 0.2s; }
  .btn-primary { background: var(--primary-color); color: white; width: 100%; }
  .btn-primary:hover { background: var(--secondary-color); }
  table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.85em; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background: #e2e8f0; }
  select, input, textarea { width: 100%; padding: 8px; margin: 5px 0; border-radius: 6px; border: 1px solid #ccc; }
  ul { list-style-type: disc; padding-left: 20px; }
  .collapsible { background: var(--primary-color); color: white; cursor: pointer; padding: 10px; width: 100%; border: none; text-align: left; font-size: 1em; border-radius: 6px; margin-bottom: 5px; }
  .activeCollapsible, .collapsible:hover { background: var(--secondary-color); }
  .content { padding: 0 10px; display: none; overflow: hidden; background-color: var(--card-bg); border-radius: 6px; margin-bottom: 8px; }
  .ai-box { margin-top: 10px; border: 1px solid #ccc; border-radius: 6px; padding: 10px; background: #f9fafb; }
</style>
</head>
<body data-theme="light">
<header>ðŸŒ± AgriTrio Mobile â€“ AI Farming Assistant</header>

<nav>
  <button onclick="showSection('overview')" class="active">Overview</button>
  <button onclick="showSection('climate')">Climate</button>
  <button onclick="showSection('market')">Market</button>
  <button onclick="showSection('education')">Education</button>
  <button onclick="showSection('ai')">AI Assist</button>
  <button onclick="showSection('settings')">Settings</button>
</nav>

<main>
  <!-- Overview -->
  <section id="overview" class="section">
    <div class="card">
      <h2>Dashboard Overview</h2>
      <p>Real-time climate reports, dynamic crop prices, and agriculture education.</p>
    </div>
    <div class="card">
      <canvas id="trendChart" height="120"></canvas>
    </div>
  </section>

  <!-- Climate -->
  <section id="climate" class="section" style="display:none;">
    <div class="card">
      <h2>Climate Report (Live)</h2>
      <p id="weatherData">Loading weather...</p>
    </div>
  </section>

  <!-- Market -->
  <section id="market" class="section" style="display:none;">
    <div class="card">
      <h2>Market Prices</h2>
      <select id="commoditySelect"></select>
      <select id="stateSelect"></select>
      <input type="text" id="marketInput" placeholder="Enter market name"/>
      <button class="btn btn-primary" onclick="loadMarketLive()">Fetch Prices</button>
      <table id="priceTable">
        <tr><th>Commodity</th><th>Market</th><th>Min</th><th>Max</th><th>Modal</th><th>Date</th></tr>
      </table>
    </div>
  </section>

  <!-- Education -->
  <section id="education" class="section" style="display:none;">
    <div class="card">
      <h2>Education Hub</h2>
      <button class="collapsible">Land & Soil</button>
      <div class="content"><ul><li>Soil Types & Testing</li></ul></div>
      <button class="collapsible">Irrigation</button>
      <div class="content"><ul><li>Drip, Sprinkler, Flood irrigation</li></ul></div>
      <button class="collapsible">Farming Methods</button>
      <div class="content"><ul><li>Organic, Precision, Hydroponics</li></ul></div>
    </div>
  </section>

  <!-- AI Assistant -->
  <section id="ai" class="section" style="display:none;">
    <div class="card">
      <h2>AI Assistant</h2>
      <textarea id="aiInput" rows="3" placeholder="Ask about crops, diseases, fertilizers..."></textarea>
      <button class="btn btn-primary" onclick="queryAI()">Ask AI</button>
      <div class="ai-box" id="aiResponse">AI response will appear here...</div>
    </div>
  </section>

  <!-- Settings -->
  <section id="settings" class="section" style="display:none;">
    <div class="card">
      <h2>Settings</h2>
      <button class="btn" onclick="toggleTheme()">Toggle Theme</button>
      <button class="btn" onclick="alert('AgriTrio v1.0\nDeveloped for farmers.')">About App</button>
      <button class="btn" onclick="alert('Contact us: support@agritrio.com')">Contact Us</button>
    </div>
  </section>
</main>

<script>
// Navigation
function showSection(id){
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('.section').forEach(s=>s.style.display='none');
  document.getElementById(id).style.display='block';
  event.target.classList.add('active');
}

// Theme toggle
function toggleTheme(){
  const body = document.body;
  body.dataset.theme = body.dataset.theme === 'light' ? 'dark' : 'light';
}

// Collapsible
document.addEventListener("DOMContentLoaded", function(){
  document.querySelectorAll(".collapsible").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      btn.classList.toggle("activeCollapsible");
      const content = btn.nextElementSibling;
      content.style.display = content.style.display === "block" ? "none" : "block";
    });
  });
});

// Weather API
async function loadWeather(){
  try{
    let res=await fetch("https://api.open-meteo.com/v1/forecast?latitude=12.3&longitude=76.6&current_weather=true");
    let d=await res.json();
    let w=d.current_weather;
    document.getElementById("weatherData").innerHTML=`ðŸŒ¡ ${w.temperature}Â°C, ðŸ’¨ ${w.windspeed} km/h`;
  }catch(e){document.getElementById("weatherData").innerText="Weather data unavailable";}
}

// Commodity/State Dropdown
const commodities=["Wheat","Rice","Maize","Barley","Millets","Mustard","Soybean","Cotton","Sugarcane"];
const states=["Karnataka","Maharashtra","Punjab","Haryana"];
function populateDropdowns(){
  const cSelect=document.getElementById("commoditySelect");
  const sSelect=document.getElementById("stateSelect");
  commodities.forEach(c=>cSelect.add(new Option(c,c)));
  states.forEach(s=>sSelect.add(new Option(s,s)));
}

// Market Prices
async function fetchAgmarknetPrice(commodity,state,market){
  try{
    const apiUrl=`https://agmarknetapi.herokuapp.com/request?commodity=${encodeURIComponent(commodity)}&state=${encodeURIComponent(state)}&market=${encodeURIComponent(market)}`;
    const resp=await fetch(apiUrl);
    if(!resp.ok) throw new Error("Bad response");
    return await resp.json();
  }catch(err){ return [{Commodity:commodity,City:market,"Min Prize":2000,"Max Prize":2400,"Model Prize":2200,Date:new Date().toLocaleDateString()}]; }
}
async function loadMarketLive(){
  const c=document.getElementById("commoditySelect").value;
  const s=document.getElementById("stateSelect").value;
  const m=document.getElementById("marketInput").value || "Default Market";
  const table=document.getElementById("priceTable");
  table.querySelectorAll("tr:not(:first-child)").forEach(r=>r.remove());
  const data=await fetchAgmarknetPrice(c,s,m);
  data.forEach(rec=>{
    const r=table.insertRow();
    r.insertCell(0).innerText=rec["Commodity"];
    r.insertCell(1).innerText=rec["City"];
    r.insertCell(2).innerText=rec["Min Prize"];
    r.insertCell(3).innerText=rec["Max Prize"];
    r.insertCell(4).innerText=rec["Model Prize"];
    r.insertCell(5).innerText=rec["Date"];
  });
}

// Chart
function renderChart(){
  const ctx=document.getElementById("trendChart");
  new Chart(ctx,{type:"line",data:{
    labels:["Jan","Feb","Mar","Apr","May"],
    datasets:[
      {label:"Wheat",data:[2200,2250,2300,2400,2450],borderColor:"#2563eb",fill:false,tension:0.3},
      {label:"Rice",data:[3000,3100,3050,3150,3200],borderColor:"#16a34a",fill:false,tension:0.3}
    ]
  }, options:{plugins:{tooltip:{mode:'index',intersect:false}}}});
}

// Open Source AI Assist (Example using HuggingFace Inference API)
async function queryAI(){
  const input = document.getElementById("aiInput").value;
  const resBox = document.getElementById("aiResponse");
  resBox.innerHTML="Thinking...";
  try{
    const response = await fetch("https://api-inference.huggingface.co/models/gpt2", {
      method:"POST",
      headers:{ "Authorization":"Bearer hf_your_open_source_token_here","Content-Type":"application/json" },
      body: JSON.stringify({inputs: input})
    });
    const data = await response.json();
    resBox.innerHTML = data[0]?.generated_text || "No response from AI.";
  }catch(e){resBox.innerHTML="AI API unavailable.";}
}

// Init
window.onload=()=>{
  populateDropdowns();
  loadWeather();
  renderChart();
}
</script>
</body>
</html>
